<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover" />
  <title>AK/EP ä¸¥è‹›å…¨æµç¨‹æ¨¡æ‹Ÿ (v3.0)</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css" />

  <style>
    /* === åŸºç¡€æ ·å¼é‡ç½® === */
    body { background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; }
    [v-cloak] { display: none; }

    /* =========================================
       1. åˆ—è¡¨é¡µæ ·å¼ (ä¿æŒä¸å˜ï¼Œç”¨äºè§¦å‘è„šæœ¬)
       ========================================= */
    .EpList { padding-top: 10px; padding-bottom: 60px; }
    .items { display: flex; flex-direction: column; gap: 15px; padding: 15px; min-height: 300px; }
    
    /* è„šæœ¬å…¥å£ç›®æ ‡ */
    .items .item {
      background: #fff; border-radius: 10px; padding: 15px;
      position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer;
    }
    .item .top { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
    .item .avatar { width: 40px; height: 40px; border-radius: 50%; background: #eee; }
    .item .name { font-weight: bold; font-size: 16px; color: #333; }
    .item .center { display: flex; justify-content: space-around; margin-bottom: 10px; }
    .center-item { text-align: center; }
    .center-item .value { font-size: 20px; font-weight: bold; color: #000; }
    .center-item .label { font-size: 12px; color: #666; }
    .item .bottom { 
      background: linear-gradient(90deg, #00C0F2 0%, #BFFC85 100%);
      color: #fff; padding: 5px 15px; border-radius: 20px; 
      display: flex; justify-content: space-between; font-size: 12px;
    }
    .empty-tip { text-align: center; color: #999; padding-top: 80px; font-size: 14px; }

    /* =========================================
       2. è¯¦æƒ…é¡µæ ·å¼ (ä¸¥æ ¼å¤åˆ» ep.list.detail.html)
       ========================================= */
    #detail-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #f5f5f5; z-index: 999; display: flex; flex-direction: column;
      overflow-y: auto;
    }

    /* æ¨¡æ‹Ÿ TopBack ç»„ä»¶ */
    .TopBack {
        height: 44px; background: #fff; display: flex; align-items: center; padding: 0 15px;
        font-size: 16px; font-weight: bold; justify-content: center; position: relative;
        border-bottom: 1px solid #eee;
    }
    .TopBack .icon { position: absolute; left: 15px; font-weight: normal; color: #666; cursor: pointer; }

    /* æ¨¡æ‹Ÿ .ep-list-detail å®¹å™¨ */
    .ep-list-detail {
        padding: 15px;
        flex: 1;
    }

    /* æ¨¡æ‹Ÿ special-shaped-layout3 åŠå…¶å†…éƒ¨ç»“æ„ */
    .SpecialShapedLayout3 {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        margin-bottom: 30px;
        position: relative;
    }

    .ep-list-detail .top {
        display: flex; align-items: center; justify-content: center;
        flex-direction: column; margin-bottom: 20px;
    }
    .ep-list-detail .avatar { width: 50px; height: 50px; border-radius: 50%; background: #eee; margin-bottom: 8px; }
    .ep-list-detail .user-name { font-size: 14px; color: #666; }

    .ep-list-detail .count {
        font-size: 36px; font-weight: bold; text-align: center;
        color: #00C0F2; margin-bottom: 30px;
    }

    .ep-list-detail .list { display: flex; flex-direction: column; gap: 15px; }
    .ep-list-detail .list .item {
        display: flex; justify-content: space-between; align-items: center;
        font-size: 14px; padding: 0; box-shadow: none; border-radius: 0;
    }
    .ep-list-detail .list .item .label { color: #999; }
    .ep-list-detail .list .item .value { color: #333; font-weight: 500; }

    /* âš ï¸ æ ¸å¿ƒï¼šCustomButton æ ·å¼è¿˜åŸ */
    .CustomButton {
        margin: 0 25px; /* åŒ¹é…æºç  style="margin: 0 25px;" */
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
    }
    .CustomButton .custom-content {
        height: 45px;
        border-radius: 999px;
        background-image: linear-gradient(90deg, #00C0F2 0%, #BFFC85 100%);
        color: #fff;
        font-size: 16px;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 192, 242, 0.3);
        position: relative;
    }
    /* æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»æ€ */
    .CustomButton:active .custom-content { opacity: 0.9; transform: scale(0.98); }

    /* =========================================
       3. æˆåŠŸé¡µæ ·å¼
       ========================================= */
    #success-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #fff; z-index: 1001; display: flex; flex-direction: column;
    }
    .success-content { padding: 60px 30px; text-align: center; }
    .success-title { font-size: 22px; font-weight: bold; margin: 20px 0 10px; color: #333; }
    .success-desc { font-size: 14px; color: #999; margin-bottom: 50px; line-height: 1.6; }
    
    /* è„šæœ¬ç‚¹å‡»ç‰¹æ•ˆ */
    .ak-target-hit { border: 2px solid red !important; animation: ak-shake 0.4s; }
    @keyframes ak-shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    
    <div class="EpList" v-show="!showDetail && !showSuccess">
      <van-tabs v-model="tabActive" @click="onTabClick" sticky>
        <van-tab v-for="(item, index) in tabControl" :key="index" :title="item.title">
          <van-pull-refresh v-model="item.isReloading" @refresh="onRefresh">
            <van-list v-model="item.loading" :finished="item.finished" finished-text="æ²¡æœ‰æ›´å¤šäº†" @load="loadMore">
              
              <div style="background:#fff3e0; color:#e65100; padding:8px; font-size:12px; text-align:center;">
                ç¬¬ <b>{{ refreshCount }}</b> æ¬¡åˆ·æ–° 
                <span v-if="refreshCount < 4">(æš‚æ— è®¢å•)</span>
                <span v-else style="color:green; font-weight:bold;">(ğŸ”¥ è®¢å•å‡ºç°!)</span>
              </div>

              <div class="items">
                <div v-if="item.list.length === 0" class="empty-tip">
                  <van-loading size="24px" vertical>åŠ è½½ä¸­...</van-loading>
                  <div style="margin-top:10px">æš‚æ— æŒ‚å•æ•°æ®</div>
                </div>

                <div class="item" v-for="(_item, _index) of item.list" :key="_index" @click="gotoDetail(_item)">
                  <div class="top">
                    <div class="avatar"></div>
                    <div class="name">{{ _item.Seller.FlowNumber }}</div>
                  </div>
                  <div class="center">
                    <div class="center-item"><div class="value">{{ _item.EPAmount }}</div><div class="label">EP</div></div>
                    <div class="center-item"><div class="value">{{ _item.Netincome }}</div><div class="label">USDT</div></div>
                  </div>
                  <div class="bottom">
                    <div class="left">{{ _item.Nation }}</div>
                    <div class="right">{{ _item.CreateTime }}</div>
                  </div>
                </div>
              </div>

            </van-list>
          </van-pull-refresh>
        </van-tab>
      </van-tabs>
    </div>

    <div id="detail-page" v-if="showDetail">
      <div class="TopBack">
          <span class="icon" @click="closeDetail">â®</span>
          å‡ºå”®è©³æƒ…
      </div>
      
      <div class="ep-list-detail">
        
        <div class="SpecialShapedLayout3">
            <div class="top">
                <div class="avatar"></div>
                <div class="user-name">{{ currentItem.Seller.FlowNumber }}</div>
            </div>
            
            <div class="count">{{ currentItem.EPAmount }}</div>
            
            <div class="list">
                <div class="item">
                    <span class="label">å®ä»˜é‡‘é¢</span>
                    <span class="value">{{ currentItem.Netincome }} USDT</span>
                </div>
                <div class="item">
                    <span class="label">äº¤æ˜“å•å·</span>
                    <span class="value">EP{{ currentItem.Id }}</span>
                </div>
                <div class="item">
                    <span class="label">çŠ¶æ€</span>
                    <span class="value" style="color:#00C0F2">{{ currentItem.StatusName }}</span>
                </div>
                <div class="item">
                    <span class="label">åˆ›å»ºæ—¶é—´</span>
                    <span class="value">{{ currentItem.CreateTime }}</span>
                </div>
            </div>
        </div>

        <div class="CustomButton" style="margin: 0 25px;" @click="confirm">
            <div class="custom-content">
                {{ language.CONFIRM_BUTTON_TEXT }}
            </div>
        </div>

      </div>
    </div>

    <div id="success-page" v-if="showSuccess">
      <div class="TopBack"><span class="icon" @click="goBackToList">â®</span>æ“ä½œçµæœ</div>
      <div class="success-content">
        <van-icon name="checked" color="#07c160" size="80" style="margin-bottom:20px"></van-icon>
        <div class="success-title">æ¶å–®æˆåŠŸï¼Œè«‹ç›¡å¿«ä»˜æ¬¾</div>
        <div class="success-desc">è«‹åŠæ™‚è½‰è³¬çµ¦è³£å®¶</div>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <van-button size="large" type="primary" color="#07c160">è¿”å›ç©å®¶è´¦æˆ·</van-button>
            <van-button size="large" plain @click="goBackToList">è¿”å›å‡ºå”®åˆ—è¡¨</van-button>
        </div>
      </div>
    </div>

    <van-dialog id="van-dialog"></van-dialog>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>

  <script>
    window.APP = {
      GLOBAL: { getUserModel: () => ({ FlowNumber: 'MyUser123' }), toastMsg: (msg) => vant.Toast(msg) },
      CONFIG: { BASE_Shunt: 'https://mock-api.com/' }
    };

    window._vue = new Vue({
      el: '#app',
      data: {
        tabActive: 0,
        showDetail: false,
        showSuccess: false,
        currentItem: {},
        refreshCount: 0, 
        // æ¨¡æ‹Ÿè¯­è¨€åŒ…ï¼Œå…³é”®æ˜¯è¿™ä¸ªæ–‡æœ¬è¦åŒ¹é…è„šæœ¬çš„å…³é”®å­—
        language: { 
            INPUT_PLAYER_ID: 'è¯·è¾“å…¥ID', 
            SEARCH: 'æœç´¢',
            CONFIRM_BUTTON_TEXT: 'ç¢ºèªè³¼è²·', // ç¹ä½“ï¼ŒåŒ¹é…è„šæœ¬
            POPUP_TITLE_TEXT: 'è³¼è²·EPäº¤æ˜“ç¢ºèª',
            POPUP_MESSAGE_TEXT: 'ç¡®è®¤è¦è´­ä¹°æ­¤è®¢å•å—ï¼Ÿ',
            POPUP_CONFIRM_TEXT: 'ç¢ºèª', // ç¹ä½“ï¼ŒåŒ¹é…è„šæœ¬
            POPUP_CANCEL_TEXT: 'å–æ¶ˆ'
        },
        tabControl: [
          { title: 'æŒ‚å–®ä¸­', list: [], pageIndex: 0, isLoading: false, loading: false, finished: false, isReloading: false },
          { title: 'äº¤æ˜“ä¸­', list: [] },
          { title: 'å·²å®Œæˆ', list: [] }
        ]
      },
      methods: {
        loadPageData() {
          const tab = this.tabControl[this.tabActive];
          tab.isLoading = true;
          this.refreshCount++;
          console.log(`[Mock] åˆ·æ–°è¯·æ±‚... (ç¬¬ ${this.refreshCount} æ¬¡)`);
          
          setTimeout(() => {
            if (this.tabActive === 0 && this.refreshCount >= 4) {
              tab.list = [{
                Id: 888888, EPAmount: 1000, Netincome: 920, Currency: 'USDT', Nation: 'Global',
                StatusName: 'å‡ºå”®ä¸­', CreateTime: 'åˆšåˆš', Seller: { FlowNumber: 'RichMan001' }
              }];
              console.log('[Mock] âœ… è®¢å•å·²åˆ·æ–°å‡ºæ¥ï¼');
            } else {
              tab.list = [];
              console.log('[Mock] â³ æ— è®¢å•ï¼Œç»§ç»­ç­‰å¾…...');
            }
            tab.loading = false;
            tab.isLoading = false; 
            tab.isReloading = false;
          }, 300); 
        },

        onRefresh() { this.tabControl[this.tabActive].finished = false; this.loadPageData(); },
        loadMore() { setTimeout(() => { this.tabControl[this.tabActive].loading = false; }, 500); },
        onTabClick() { this.loadPageData(); },
        
        gotoDetail(item) {
          console.log('[Mock] è¿›å…¥è¯¦æƒ…é¡µ');
          this.currentItem = item;
          this.showDetail = true;
        },
        closeDetail() { this.showDetail = false; },

        // === å¯¹åº” ep.list.detail.html ä¸­çš„ confirm æ–¹æ³• ===
        confirm() {
          console.log('[Mock] ç‚¹å‡»äº† "ç¢ºèªè³¼è²·" æŒ‰é’®');
          
          // ä½¿ç”¨ Vant çš„ Dialog ç»„ä»¶ï¼Œè¿™ä¼šç”Ÿæˆ .van-dialog__confirm
          // è¿™æ­£æ˜¯è„šæœ¬ç¬¬äºŒæ­¥è¦ç‚¹å‡»çš„ç›®æ ‡
          this.$dialog.confirm({
            title: this.language.POPUP_TITLE_TEXT,
            message: this.language.POPUP_MESSAGE_TEXT,
            confirmButtonText: this.language.POPUP_CONFIRM_TEXT,
            cancelButtonText: this.language.POPUP_CANCEL_TEXT
          })
          .then(() => {
            this.$toast.loading({ duration: 0, forbidClick: true, message: 'æŠ¢å•ä¸­...' });
            setTimeout(() => {
              this.$toast.clear();
              this.showDetail = false;
              this.showSuccess = true;
              console.log('[Mock] æŠ¢å•æˆåŠŸï¼Œè·³è½¬ç»“æœé¡µ');
            }, 600);
          })
          .catch(() => {});
        },

        goBackToList() {
          console.log('[Mock] è¿”å›åˆ—è¡¨ï¼Œé‡ç½®æµç¨‹');
          this.showSuccess = false;
          this.showDetail = false;
          this.refreshCount = 0;
          this.tabControl[0].list = [];
          this.loadPageData();
        }
      },
      mounted() {
        this.loadPageData();
      }
    });
  </script>
</body>
</html>
