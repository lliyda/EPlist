<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover" />
  <title>AK/EP 抢单全流程模拟</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css" />

  <style>
    /* === 基础样式模拟 === */
    body { background-color: #f5f5f5; font-family: sans-serif; margin: 0; padding: 0; }
    [v-cloak] { display: none; }

    /* === 列表样式模拟 === */
    .EpList { padding-top: 10px; padding-bottom: 60px; }
    .items { display: flex; flex-direction: column; gap: 20px; padding: 15px; }
    
    /* 核心 DOM 结构：脚本寻找的目标 */
    .items .item {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      cursor: pointer;
    }

    /* 模拟选中/点击特效的样式 (脚本注入的样式会覆盖这个，这里只是为了演示) */
    .ak-target-hit {
      border: 2px solid red !important;
    }

    .item .top { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
    .item .avatar { width: 40px; height: 40px; border-radius: 50%; background: #ccc; }
    .item .name { font-weight: bold; font-size: 16px; }
    
    .item .center { display: flex; justify-content: space-around; margin-bottom: 10px; }
    .center-item { text-align: center; }
    .center-item .value { font-size: 20px; font-weight: bold; color: #000; }
    .center-item .label { font-size: 12px; color: #666; }

    .item .bottom { 
      background: linear-gradient(90deg, #00C0F2 0%, #BFFC85 100%);
      color: #fff; padding: 5px 15px; border-radius: 20px; 
      display: flex; justify-content: space-between; font-size: 12px;
    }

    /* === 详情页模拟样式 === */
    #detail-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #f5f5f5; z-index: 999; display: flex; flex-direction: column;
    }
    .detail-card {
      margin: 20px; background: #fff; border-radius: 10px; padding: 20px;
      text-align: center;
    }
    
    /* === 成功页模拟样式 (新增) === */
    #success-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #fff; z-index: 1001; /* 比详情页更高 */
      display: flex; flex-direction: column;
    }
    .success-content {
      padding: 40px 20px;
      text-align: center;
      display: flex; flex-direction: column; align-items: center;
    }
    .success-icon { margin-bottom: 20px; }
    .success-title { font-size: 20px; font-weight: bold; margin-bottom: 10px; color: #333; }
    .success-desc { font-size: 14px; color: #999; line-height: 1.5; margin-bottom: 40px; }
    .success-btns { width: 100%; display: flex; flex-direction: column; gap: 15px; }
    .btn-green { background-color: #67C23A; color: white; border: none; }
    .btn-white { background-color: white; color: #666; border: 1px solid #ebedf0; }

    /* 底部购买栏 */
    .van-goods-action { z-index: 1000; }
    .van-goods-action-button { height: 50px; font-weight: bold; font-size: 16px; }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    
    <div class="EpList" v-show="!showDetail && !showSuccess">
      <van-tabs v-model="tabActive" @click="onTabClick">
        <van-tab v-for="(item, index) in tabControl" :key="index" :title="item.title">
          
          <van-pull-refresh v-model="item.isReloading" @refresh="onRefresh">
            <van-list
              v-model="item.loading"
              :finished="item.finished"
              finished-text="没有更多了"
              @load="loadMore"
            >
              <div class="items">
                <div class="item" v-for="(_item, _index) of item.list" :key="_index" @click="gotoDetail(_item)">
                  <div class="top">
                    <div class="avatar"></div>
                    <div class="name">{{ _item.Seller.FlowNumber }}</div>
                  </div>
                  <div class="center">
                    <div class="center-item">
                      <div class="value">{{ _item.EPAmount }}</div>
                      <div class="label">EP</div>
                    </div>
                    <div class="center-item">
                      <div class="value">{{ _item.Netincome }}</div>
                      <div class="label">USDT</div>
                    </div>
                  </div>
                  <div class="bottom">
                    <div class="left">{{ _item.Nation }}</div>
                    <div class="right">{{ _item.CreateTime }}</div>
                  </div>
                </div>
              </div>
            </van-list>
          </van-pull-refresh>

        </van-tab>
      </van-tabs>
    </div>

    <div id="detail-page" v-if="showDetail">
      <van-nav-bar title="出售詳情" left-arrow @click-left="closeDetail"></van-nav-bar>
      
      <div class="detail-card">
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">
          {{ currentItem.EPAmount }} EP
        </div>
        <div style="color: #666;">
          卖家: {{ currentItem.Seller.FlowNumber }}
        </div>
      </div>

      <van-goods-action>
        <van-goods-action-button 
          type="primary" 
          text="確認購買" 
          @click="onBuyClick"
          color="linear-gradient(to right, #00C0F2, #BFFC85)"
        ></van-goods-action-button>
      </van-goods-action>
    </div>

    <div id="success-page" v-if="showSuccess">
      <van-nav-bar title="操作結果" left-arrow @click-left="goBackToList"></van-nav-bar>
      
      <div class="success-content">
        <div class="success-icon">
          <van-icon name="checked" color="#07c160" size="80" />
        </div>
        
        <div class="success-title">搶單成功，請盡快付款</div>
        
        <div class="success-desc">
          為了避免您的交易信用降低，請您及時轉賬給賣家並在“買賣中心”中點擊“確認付款”按鈕
        </div>

        <div class="success-btns">
          <van-button size="large" class="btn-green">返回玩家账户 (ID)</van-button>
          
          <van-button size="large" class="btn-white" @click="goBackToList">
            返回出售列表
          </van-button>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>

  <script>
    window.APP = {
      GLOBAL: {
        getUserModel: () => ({ FlowNumber: 'MyUser123' }),
        toastMsg: (msg) => vant.Toast(msg)
      },
      CONFIG: { BASE_Shunt: 'https://mock-api.com/' }
    };

    const mockLanguage = {
      INPUT_PLAYER_ID: '请输入玩家ID',
      SEARCH: '搜索',
      LI_1_TEXT: 'EP数量',
      RECEIVE_BUTTON: '确认收款'
    };

    window._vue = new Vue({
      el: '#app',
      data: {
        tabActive: 0,
        showDetail: false,
        showSuccess: false, // 新增：控制成功页显示
        currentItem: {},
        language: mockLanguage,
        language2: { t1: '下拉刷新', t2: '释放刷新', t3: '加载中...', t4: '刷新成功' },
        language3: { t1: '没有更多了' },
        currentUser: { FlowNumber: 'Me' },
        tabControl: [
          {
            title: '挂單中', 
            list: [], pageIndex: 0, isLoading: false, loading: false, finished: false, isReloading: false
          },
          { title: '交易中', list: [] },
          { title: '已完成', list: [] }
        ]
      },
      methods: {
        loadPageData() {
          const tab = this.tabControl[this.tabActive];
          tab.isLoading = true;
          console.log('[Mock] Loading data...');
          
          setTimeout(() => {
            const mockData = [
              {
                Id: 101, EPAmount: 290, Netincome: 265, Currency: 'USDT', Nation: 'Global-USDT',
                StatusName: '出售中', CreateTime: '2025/12/11 16:18:40',
                Seller: { FlowNumber: 'qx1818', Avatar: '' }
              },
              {
                Id: 102, EPAmount: 500, Netincome: 480, Currency: 'USDT', Nation: 'Global-USDT',
                StatusName: '出售中', CreateTime: '2025/12/11 16:20:00',
                Seller: { FlowNumber: 'seller02', Avatar: '' }
              }
            ];
            if (this.tabActive === 0) { tab.list = mockData; } else { tab.list = []; }
            tab.loading = false; tab.isLoading = false; tab.isReloading = false;
            console.log('[Mock] Data loaded.');
          }, 500); 
        },

        onRefresh() {
          this.tabControl[this.tabActive].finished = false;
          this.loadPageData();
        },

        loadMore() {
          setTimeout(() => {
            this.tabControl[this.tabActive].loading = false;
            this.tabControl[this.tabActive].finished = true;
          }, 500);
        },

        onTabClick() { this.loadPageData(); },

        gotoDetail(item) {
          console.log('[Mock] Clicked Item:', item);
          this.currentItem = item;
          this.showDetail = true;
        },

        closeDetail() { this.showDetail = false; },

        // === 核心逻辑：模拟点击购买流程 ===
        onBuyClick() {
          console.log('[Mock] Buy Clicked. Showing Dialog...');
          
          this.$dialog.confirm({
            title: '購買EP交易確認',
            message: '确认要购买此订单吗？',
            confirmButtonText: '確認', 
            cancelButtonText: '取消'
          })
          .then(() => {
            // 模拟服务器延迟
            this.$toast.loading({ duration: 0, forbidClick: true, message: '抢单中...' });
            
            setTimeout(() => {
              this.$toast.clear();
              // 跳转到成功页
              this.showDetail = false;
              this.showSuccess = true; 
              console.log('[Mock] Order Success. Redirected to Result Page.');
            }, 800);
          })
          .catch(() => {});
        },

        // 模拟返回列表页
        goBackToList() {
          console.log('[Mock] Returning to list...');
          this.showSuccess = false;
          this.showDetail = false;
          this.loadPageData(); // 重新加载列表，模拟刷新
        },
        
        numberFormat(val) { return val; }
      },
      mounted() {
        this.loadPageData();
      }
    });
  </script>
</body>
</html>
