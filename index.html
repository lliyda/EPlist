<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AK/EP 模拟交易</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css" />
    <style>
        /* --- 全局基础 --- */
        body {
            background-color: #f7f8fa;
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Segoe UI, Arial, Roboto, "PingFang SC", sans-serif;
            margin: 0;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }
        [v-cloak] { display: none; }
        #app { min-height: 100vh; display: flex; flex-direction: column; }

        /* --- 变量 --- */
        :root {
            --gradient-primary: linear-gradient(90deg, #00C0F2 0%, #BFFC85 100%);
            --text-green: #28D8A1;
        }

        /* --- 列表页样式 --- */
        .search-bar {
            background-color: #fff !important;
            padding: 10px 16px;
        }
        .van-search__content {
            background-color: #f7f8fa;
            border-radius: 999px;
        }

        .trade-card {
            background: #fff;
            margin: 15px 16px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.03);
            position: relative;
        }
        
        /* 顶部用户信息 */
        .card-top {
            padding: 16px 16px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info { display: flex; align-items: center; }
        .avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            background-color: #eee;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23999"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>');
            background-size: cover;
            margin-right: 10px;
            border: 1px solid #f0f0f0;
        }
        .status-tag {
            background: var(--gradient-primary);
            color: white;
            padding: 4px 12px;
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
            font-size: 12px;
            margin-right: -16px;
        }

        /* 中间数值 */
        .card-center {
            padding: 10px 0 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
            position: relative;
        }
        .card-center::before {
            content: ''; position: absolute; top: 0; left: 16px; right: 16px;
            height: 1px; border-top: 1px dashed #eee;
        }
        .data-item .num { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 4px; }
        .data-item .label { font-size: 12px; color: #999; }

        /* 底部条 */
        .card-bottom {
            background: var(--gradient-primary);
            padding: 6px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            font-size: 11px;
        }

        /* --- 详情页样式 --- */
        .page-header {
            background: #fff;
            height: 46px;
            display: flex; align-items: center; justify-content: center;
            font-size: 17px; font-weight: 500;
            position: sticky; top: 0; z-index: 99;
            border-bottom: 1px solid #f5f5f5;
        }
        .header-left { position: absolute; left: 10px; padding: 10px; }
        
        .detail-card {
            background: #fff;
            margin: 15px 16px;
            border-radius: 16px;
            overflow: hidden;
            padding-bottom: 10px;
        }
        .detail-info-row {
            display: flex; justify-content: space-between; padding: 20px 30px;
            text-align: center;
        }
        .detail-limit-box {
            background: #fff; margin: 0 16px; border-radius: 16px; padding: 20px;
        }
        .limit-item {
            display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 14px;
        }
        .limit-item:last-child { margin-bottom: 0; }
        .limit-label { font-weight: bold; color: #333; }
        .limit-val { font-weight: bold; color: #333; }

        /* 底部固定按钮容器 */
        .fixed-bottom {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #fff; padding: 10px 20px 20px;
        }
        .btn-submit {
            height: 50px; line-height: 50px; text-align: center;
            color: white; font-size: 16px; font-weight: bold;
            border-radius: 25px;
            background: var(--gradient-primary);
            box-shadow: 0 4px 10px rgba(0, 192, 242, 0.3);
        }
        .btn-submit:active { opacity: 0.9; }

        /* --- 成功页样式 --- */
        .success-container {
            background: #fff; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            padding-top: 80px;
        }
        .success-icon-circle {
            width: 80px; height: 80px;
            background: #28a745;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            margin-bottom: 20px;
        }
        .s-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .s-desc {
            font-size: 13px; color: #666; text-align: center;
            padding: 0 40px; line-height: 1.6; margin-bottom: 40px;
        }
        .btn-green {
            width: 90%; padding: 12px 0;
            background-color: #70C160; color: white;
            text-align: center; border-radius: 4px;
            margin-bottom: 15px; font-size: 15px; font-weight: 500;
        }
        .btn-white {
            width: 90%; padding: 12px 0;
            background-color: #fff; color: #999;
            border: 1px solid #eee; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            text-align: center; border-radius: 4px;
            font-size: 15px;
        }

        /* 覆盖 Vant Dialog 样式以匹配截图 */
        .custom-dialog .van-dialog__header { padding-top: 20px; font-weight: bold; }
        .custom-dialog .van-dialog__content { padding: 20px; text-align: center; color: #333; }
        .custom-dialog .van-button { height: 44px; }
        .custom-dialog .van-dialog__confirm { color: #1989fa; }
    </style>
</head>
<body>

<div id="app" v-cloak>
    
    <div v-if="view === 'list'" style="padding-bottom: 60px;">
        <van-tabs v-model="activeTab" line-width="20px" line-height="3px" color="#333" title-active-color="#333">
            <van-tab title="挂單中"></van-tab>
            <van-tab title="交易中"></van-tab>
            <van-tab title="已完成"></van-tab>
        </van-tabs>

        <div class="search-bar">
            <van-search v-model="searchKey" placeholder="請輸入ID或登錄名" shape="round" left-icon="search"></van-search>
        </div>

        <van-pull-refresh v-model="refreshing" @refresh="onRefresh" success-text="刷新成功">
            <van-list v-model="loading" :finished="finished" finished-text="沒有更多了" style="min-height: 300px;">
                
                <div v-if="list.length === 0" style="text-align: center; padding-top: 100px; color: #999; font-size: 14px;">
                    暫無數據 (請下拉刷新試試)
                </div>

                <div class="trade-card" v-for="(item, i) in list" :key="i" @click="toDetail(item)">
                    <div class="card-top">
                        <div class="user-info">
                            <div class="avatar"></div>
                            <span style="font-size: 16px; font-weight: bold;">{{ item.user }}</span>
                        </div>
                        <div class="status-tag">出售中</div>
                    </div>
                    
                    <div class="card-center">
                        <div class="data-item">
                            <div class="num">{{ item.ep }}</div>
                            <div class="label">EP數量</div>
                        </div>
                        <div class="data-item">
                            <div class="num">{{ item.usdt }}</div>
                            <div class="label">USDT</div>
                        </div>
                    </div>

                    <div class="card-bottom">
                        <span>Global-USDT</span>
                        <span>{{ item.time }}</span>
                    </div>
                </div>

            </van-list>
        </van-pull-refresh>

        <van-tabbar v-model="tabActive" active-color="#00C0F2">
            <van-tabbar-item icon="home-o">首頁</van-tabbar-item>
            <van-tabbar-item icon="exchange">AK交易</van-tabbar-item>
            <van-tabbar-item icon="balance-list">EP交易</van-tabbar-item>
            <van-tabbar-item icon="user-o">我的</van-tabbar-item>
        </van-tabbar>
    </div>

    <div v-if="view === 'detail'" style="background: #f7f8fa; min-height: 100vh;">
        <div class="page-header">
            <div class="header-left" @click="backToList">
                <van-icon name="arrow-left" size="20" color="#333"/>
            </div>
            出售詳情
        </div>

        <div class="detail-card">
            <div class="card-top" style="border: none;">
                <div class="user-info">
                    <div class="avatar"></div>
                    <span style="font-size: 16px; font-weight: bold;">{{ currentOrder.user }}</span>
                </div>
            </div>
            <div style="border-top: 1px dashed #eee; margin: 0 16px;"></div>
            <div class="detail-info-row">
                <div class="data-item">
                    <div class="num">{{ currentOrder.ep }}</div>
                    <div class="label">EP</div>
                </div>
                <div class="data-item">
                    <div class="num">{{ parseInt(currentOrder.usdt) }}</div> <div class="label">USDT</div>
                </div>
            </div>
            <div class="card-bottom">
                <span>Global-USDT</span>
                <span>{{ currentOrder.time }}</span>
            </div>
        </div>

        <div class="detail-limit-box">
            <div class="limit-item">
                <span class="limit-label">買家付款期限</span>
                <span class="limit-val">120分鐘</span>
            </div>
            <div class="limit-item">
                <span class="limit-label">賣家確認期限</span>
                <span class="limit-val">120分鐘</span>
            </div>
        </div>

        <div class="fixed-bottom">
            <div class="btn-submit" @click="confirmBuy">確認購買</div>
        </div>
    </div>

    <div v-if="view === 'success'" class="success-container">
        <div style="width: 100%; height: 46px; position: absolute; top: 0; display: flex; align-items: center;">
            <van-icon name="arrow-left" size="20" style="padding: 10px;" @click="backToList"></van-icon>
            <span style="flex: 1; text-align: center; font-size: 17px; font-weight: 500; padding-right: 40px;">操作結果</span>
        </div>

        <div class="success-icon-circle">
            <van-icon name="success" color="#fff" size="40" />
        </div>

        <div class="s-title">搶單成功，請盡快付款</div>
        <div class="s-desc">
            為了避免您的交易信用降低，請您及時轉賬給賣家並在“買賣中心”中點擊“確認付款”按鈕
        </div>

        <div class="btn-green" @click="backToList">返回玩家账户 (ID)</div>
        <div class="btn-white" @click="backToList">返回出售列表</div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>

<script>
    new Vue({
        el: '#app',
        data() {
            return {
                view: 'list', // 当前视图: list, detail, success
                activeTab: 0,
                tabActive: 2,
                searchKey: '',
                
                // 列表相关
                refreshing: false,
                loading: false,
                finished: true,
                refreshCount: 0, // 记录刷新次数
                list: [],
                
                // 当前选中订单
                currentOrder: {}
            };
        },
        methods: {
            onRefresh() {
                this.finished = false;
                this.loading = true;
                
                setTimeout(() => {
                    this.refreshCount++;
                    this.refreshing = false;
                    this.loading = false;
                    
                    // 模拟刷新逻辑：第2次刷新时才出现订单
                    if (this.refreshCount >= 2) {
                        this.list = [{
                            user: 'qx1818',
                            ep: '290',
                            usdt: '265.5222',
                            time: this.getTimeStr()
                        }];
                        this.finished = true;
                    } else {
                        // 前几次刷新为空
                        this.list = [];
                        this.finished = true;
                    }
                }, 800); // 模拟网络延迟
            },
            
            toDetail(item) {
                this.currentOrder = item;
                this.view = 'detail';
            },
            
            backToList() {
                this.view = 'list';
                this.refreshCount = 0; // 重置刷新计数，方便重复测试
                this.list = []; // 清空列表
            },

            confirmBuy() {
                // 弹出确认框，样式模仿截图
                this.$dialog.confirm({
                    title: '購買EP交易確認', // 标题
                    message: '', // 内容为空
                    confirmButtonText: '確認',
                    cancelButtonText: '取消',
                    confirmButtonColor: '#1989fa',
                    className: 'custom-dialog'
                }).then(() => {
                    // 点击确认
                    this.view = 'success';
                }).catch(() => {
                    // 点击取消
                });
            },

            getTimeStr() {
                const now = new Date();
                const pad = (n) => n.toString().padStart(2, '0');
                return `${now.getFullYear()}/${pad(now.getMonth()+1)}/${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
            }
        }
    });
</script>
</body>
</html>
