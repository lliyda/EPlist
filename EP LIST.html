<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover" />
  <title>AK/EP 抢单模拟测试页</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css" />

  <style>
    /* === 基础样式模拟 (base.css) === */
    body { background-color: #f5f5f5; font-family: sans-serif; margin: 0; padding: 0; }
    [v-cloak] { display: none; }

    /* === 列表样式模拟 (ep.list.css) === */
    .EpList { padding-top: 10px; padding-bottom: 60px; }
    .items { display: flex; flex-direction: column; gap: 20px; padding: 15px; }
    
    /* 核心 DOM 结构：脚本寻找的目标 */
    .items .item {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      cursor: pointer;
    }

    /* 模拟选中/点击特效的样式 */
    .ak-target-hit {
      animation: ak-sniper-shake 0.4s ease-out !important;
      border: 2px solid red !important;
    }

    .item .top { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
    .item .avatar { width: 40px; height: 40px; border-radius: 50%; background: #ccc; }
    .item .name { font-weight: bold; font-size: 16px; }
    
    .item .center { display: flex; justify-content: space-around; margin-bottom: 10px; }
    .center-item { text-align: center; }
    .center-item .value { font-size: 20px; font-weight: bold; color: #000; }
    .center-item .label { font-size: 12px; color: #666; }

    .item .bottom { 
      background: linear-gradient(90deg, #00C0F2 0%, #BFFC85 100%);
      color: #fff; padding: 5px 15px; border-radius: 20px; 
      display: flex; justify-content: space-between; font-size: 12px;
    }

    /* === 详情页模拟样式 === */
    #detail-page {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #f5f5f5; z-index: 999; display: flex; flex-direction: column;
    }
    .detail-card {
      margin: 20px; background: #fff; border-radius: 10px; padding: 20px;
      text-align: center;
    }
    
    /* 底部购买栏 */
    .van-goods-action { z-index: 1000; }
    .van-goods-action-button { height: 50px; font-weight: bold; font-size: 16px; }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    
    <div class="EpList" v-show="!showDetail">
      <van-tabs v-model="tabActive" @click="onTabClick">
        <van-tab v-for="(item, index) in tabControl" :key="index" :title="item.title">
          
          <van-pull-refresh v-model="item.isReloading" @refresh="onRefresh">
            <van-list
              v-model="item.loading"
              :finished="item.finished"
              finished-text="没有更多了"
              @load="loadMore"
            >
              <div class="items">
                <div class="item" v-for="(_item, _index) of item.list" :key="_index" @click="gotoDetail(_item)">
                  <div class="top">
                    <div class="avatar"></div>
                    <div class="name">{{ _item.Seller.FlowNumber }}</div>
                  </div>
                  <div class="center">
                    <div class="center-item">
                      <div class="value">{{ _item.EPAmount }}</div>
                      <div class="label">EP</div>
                    </div>
                    <div class="center-item">
                      <div class="value">{{ _item.Netincome }}</div>
                      <div class="label">USDT</div>
                    </div>
                  </div>
                  <div class="bottom">
                    <div class="left">{{ _item.Nation }}</div>
                    <div class="right">{{ _item.CreateTime }}</div>
                  </div>
                </div>
              </div>

            </van-list>
          </van-pull-refresh>

        </van-tab>
      </van-tabs>
    </div>

    <div id="detail-page" v-if="showDetail">
      <van-nav-bar title="出售詳情" left-arrow @click-left="closeDetail"></van-nav-bar>
      
      <div class="detail-card">
        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">
          {{ currentItem.EPAmount }} EP
        </div>
        <div style="color: #666;">
          卖家: {{ currentItem.Seller.FlowNumber }}
        </div>
      </div>

      <van-goods-action>
        <van-goods-action-button 
          type="primary" 
          text="確認購買" 
          @click="onBuyClick"
          color="linear-gradient(to right, #00C0F2, #BFFC85)"
        ></van-goods-action-button>
      </van-goods-action>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>

  <script>
    // === 1. 模拟 APP 全局对象 (Base.js) ===
    window.APP = {
      GLOBAL: {
        getUserModel: () => ({ FlowNumber: 'MyUser123' }),
        toastMsg: (msg) => vant.Toast(msg)
      },
      CONFIG: {
        BASE_Shunt: 'https://mock-api.com/'
      }
    };

    // === 2. 模拟语言包 LSE ===
    const mockLanguage = {
      INPUT_PLAYER_ID: '请输入玩家ID',
      SEARCH: '搜索',
      LI_1_TEXT: 'EP数量',
      RECEIVE_BUTTON: '确认收款'
    };

    // === 3. Vue 实例 ===
    window._vue = new Vue({
      el: '#app',
      data: {
        tabActive: 0,
        showDetail: false,
        currentItem: {}, // 当前选中的订单
        language: mockLanguage,
        language2: { t1: '下拉刷新', t2: '释放刷新', t3: '加载中...', t4: '刷新成功' },
        language3: { t1: '没有更多了' },
        currentUser: { FlowNumber: 'Me' },
        
        // 模拟 Tab 数据结构
        tabControl: [
          {
            title: '挂單中', // 对应脚本寻找的列表
            list: [],
            pageIndex: 0,
            isLoading: false,
            loading: false,
            finished: false,
            isReloading: false
          },
          { title: '交易中', list: [] },
          { title: '已完成', list: [] }
        ]
      },
      methods: {
        // 模拟加载数据 (Mock API)
        loadPageData() {
          const tab = this.tabControl[this.tabActive];
          tab.isLoading = true; // 模拟 isLoading 状态
          
          console.log('[Mock] Loading data...');
          
          setTimeout(() => {
            // 模拟 API 返回的订单数据
            const mockData = [
              {
                Id: 101,
                EPAmount: 290,
                Netincome: 265,
                Currency: 'USDT',
                Nation: 'Global-USDT',
                StatusName: '出售中',
                CreateTime: '2025/12/11 16:18:40',
                Seller: { FlowNumber: 'qx1818', Avatar: '' }
              },
              {
                Id: 102,
                EPAmount: 500,
                Netincome: 480,
                Currency: 'USDT',
                Nation: 'Global-USDT',
                StatusName: '出售中',
                CreateTime: '2025/12/11 16:20:00',
                Seller: { FlowNumber: 'seller02', Avatar: '' }
              }
            ];

            if (this.tabActive === 0) {
              tab.list = mockData;
            } else {
              tab.list = [];
            }
            
            tab.loading = false;
            tab.isLoading = false; // 关键：脚本会检测这个状态变化
            tab.isReloading = false;
            
            console.log('[Mock] Data loaded.', tab.list);
          }, 500); // 500ms 延迟模拟网络请求
        },

        onRefresh() {
          this.tabControl[this.tabActive].finished = false;
          this.loadPageData();
        },

        loadMore() {
          // 简单模拟加载更多
          setTimeout(() => {
            this.tabControl[this.tabActive].loading = false;
            this.tabControl[this.tabActive].finished = true;
          }, 500);
        },

        onTabClick() {
          this.loadPageData();
        },

        // === 模拟点击进入详情页 ===
        gotoDetail(item) {
          console.log('[Mock] Clicked Item:', item);
          this.currentItem = item;
          this.showDetail = true; // 切换显示详情视图
        },

        closeDetail() {
          this.showDetail = false;
        },

        // === 模拟点击购买按钮 -> 弹出确认窗 ===
        onBuyClick() {
          console.log('[Mock] Buy Clicked. Showing Dialog...');
          
          // 使用 Vant Dialog，它会生成 .van-dialog__confirm 按钮
          // 这是脚本第二步寻找的目标
          this.$dialog.confirm({
            title: '購買EP交易確認',
            message: '确认要购买此订单吗？',
            confirmButtonText: '確認', // 繁体，匹配脚本关键字
            cancelButtonText: '取消'
          })
          .then(() => {
            this.$toast.success('搶單成功'); // 脚本通过检测这个文字判断成功
            setTimeout(() => {
              this.showDetail = false;
            }, 1000);
          })
          .catch(() => {
            // on cancel
          });
        },
        
        numberFormat(val) { return val; } // 辅助函数 mock
      },
      mounted() {
        this.loadPageData(); // 页面加载自动拉取数据
      }
    });
  </script>
</body>
</html>